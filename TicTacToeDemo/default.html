<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Tic Tac Toe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="default.css" rel="stylesheet" />
    <script src="Scripts/jquery-3.1.1.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="Scripts/default.js"></script>
</head>
<body>
    <div class="container">
        <input type="hidden" id="hfCurrentPlayer" />
        <input type="hidden" id="hfFirstPlayer" />
        <input type="hidden" id="hfSecondPlayer" />
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3 hidden-sm">
               &nbsp;
            </div>
            <div class="col-md-6 col-sm-12">
                  <div id="content">
                     <div id="result">
                        <h2>Score</h2>
                        <div>Player 1: <span id="resultX"></span></div>
                        <div>Player 2: <span id="resultO"></span></div>
                        <div>Played Rounds: <span id="totalRounds"></span></div>
                        <br />
                        <div id="message">&nbsp;</div>
                    </div>
                  </div>
            </div>
            <div class="col-md-3 hidden-sm">
                 &nbsp;
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-sm-12">
                 <div id="playerX">
                    <h3>Player 1: <label id="firstPlayer"></label> </h3>
                    <div id="squareX" data-square="X" class="square player"></div>
                </div>
            </div>
            <div class="col-md-6 col-sm-12">
                <div id="playerO" class="flex-item">
                    <h3>Player 2: <label id="secondPlayer"></label></h3>
                    <div id="squareO" data-square="O" class="square player"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-2">&nbsp;</div>
            <div class="col-sm-8">
                <div id="game">
                    <div id="gameBoard"></div>
                    <br />
                    <div>
                        <button id="btnPlayAgain" class="play-again">Play Again!</button>
                    </div>
                </div>
            </div>
            <div class="col-sm-2">&nbsp;</div>
        </div>       
    </div>
</body>
</html>
    <script type="text/javascript">
        $(function () {
            var displayName;
            // Declare a proxy to reference the hub. 
            var gameHub = $.connection.ticTacToeHub;

            // register communication
            registerCommunication(gameHub);
           
            // Start the connection.
            $.connection.hub.start().done(function () {
                // Get the user name and store it to prepend to messages.
                startConnection(gameHub);
            });
        });

        function startConnection(gameHub) {
            if ($('#hfCurrentPlayer').val().length == 0) {
                displayName = prompt('Enter your name:', '');
                $('#hfCurrentPlayer').val(displayName);
                gameHub.server.connect(displayName);
            }
        }

        function registerCommunication(gameHub) {
            // Calls when user successfully logged in
            gameHub.client.onConnected = function (gameId, firstPlayer, secondPlayer, participants) {
                if (firstPlayer.length != 0) {
                    $('#firstPlayer').text(firstPlayer);
                    $('#hfFirstPlayer').val(firstPlayer);
                }

                if (secondPlayer.length != 0) {
                    $('#secondPlayer').text(secondPlayer);
                    $('#hfSecondPlayer').val(secondPlayer);
                }
                //   setPermissableMoves(firstPlayer, secondPlayer);

                if (firstPlayer.length != 0 && secondPlayer.length != 0) {
                    gameHub.server.initializeRound();
                }
            };

            // start game
            gameHub.client.initializeRound = function () {

                start();
            }

            // play turn
            gameHub.client.playTurn = function (target, tileType) {
                MyTicTacToe.playTurn(target, tileType);
            }
        }

        function start() {
            var currentPlayer = hfCurrentPlayer.value;
            var firstPlayer = hfFirstPlayer.value;
            var secondPlayer = hfSecondPlayer.value;
            MyTicTacToe.startGame(currentPlayer, firstPlayer, secondPlayer);
        }
    </script>
